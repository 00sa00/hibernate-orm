<?xml version="1.0" encoding="UTF-8"?>
<testsuite errors="0" failures="0" hostname="dhcp-10.15.208.168.stl.redhat.com" name="org.hibernate.test.event.collection.detached.BadMergeHandlingTest" tests="1" time="0.156" timestamp="2013-02-28T20:12:24">
  <properties />
  <testcase classname="org.hibernate.test.event.collection.detached.BadMergeHandlingTest" name="testMergeAndHold" time="0.126" />
  <system-out><![CDATA[14:12:24,800  INFO CustomRunner:132 - BeforeClass: org.hibernate.test.event.collection.detached.BadMergeHandlingTest
14:12:24,806  INFO DriverManagerConnectionProviderImpl:99 - HHH000402: Using Hibernate built-in connection pool (not for production use!)
14:12:24,806  INFO DriverManagerConnectionProviderImpl:135 - HHH000115: Hibernate connection pool size: 5
14:12:24,807  INFO DriverManagerConnectionProviderImpl:138 - HHH000006: Autocommit mode: false
14:12:24,807  INFO DriverManagerConnectionProviderImpl:153 - HHH000401: using driver [org.h2.Driver] at URL [jdbc:h2:mem:db1;DB_CLOSE_DELAY=-1;MVCC=TRUE]
14:12:24,807  INFO DriverManagerConnectionProviderImpl:158 - HHH000046: Connection properties: {user=sa}
14:12:24,808  INFO Dialect:103 - HHH000400: Using dialect: org.hibernate.dialect.H2Dialect
14:12:24,808  INFO LobCreatorBuilder:94 - HHH000423: Disabling contextual LOB creation as JDBC driver reported JDBC version [3] less than 4
14:12:24,809  INFO TransactionFactoryInitiator:66 - HHH000399: Using default transaction strategy (direct JDBC transactions)
14:12:24,809  INFO ASTQueryTranslatorFactory:48 - HHH000397: Using ASTQueryTranslatorFactory
14:12:24,809  WARN CachingRegionFactory:58 - CachingRegionFactory should be only used for testing.
14:12:24,816  INFO SchemaExport:343 - HHH000227: Running hbm2ddl schema export
14:12:24,817 DEBUG SchemaExport:353 - Import file not found: /import.sql
14:12:24,817 DEBUG SQL:104 - 
    alter table CHARACTER_ALIAS 
        drop constraint FKBFBA17A55528DA3
14:12:24,817 ERROR SchemaExport:425 - HHH000389: Unsuccessful: alter table CHARACTER_ALIAS drop constraint FKBFBA17A55528DA3
14:12:24,818 ERROR SchemaExport:426 - Table "CHARACTER_ALIAS" not found; SQL statement:

    alter table CHARACTER_ALIAS 
        drop constraint FKBFBA17A55528DA3 [42102-145]
14:12:24,818 DEBUG SQL:104 - 
    alter table CHARACTER_ALIAS 
        drop constraint FKBFBA17AA869D0B6
14:12:24,818 ERROR SchemaExport:425 - HHH000389: Unsuccessful: alter table CHARACTER_ALIAS drop constraint FKBFBA17AA869D0B6
14:12:24,818 ERROR SchemaExport:426 - Table "CHARACTER_ALIAS" not found; SQL statement:

    alter table CHARACTER_ALIAS 
        drop constraint FKBFBA17AA869D0B6 [42102-145]
14:12:24,818 DEBUG SQL:104 - 
    drop table Alias if exists
14:12:24,818 DEBUG SQL:104 - 
    drop table CHARACTER_ALIAS if exists
14:12:24,818 DEBUG SQL:104 - 
    drop table CharacterTable if exists
14:12:24,818 DEBUG SQL:104 - 
    create table Alias (
        id integer not null,
        alias varchar(255),
        primary key (id)
    )
14:12:24,819 DEBUG SQL:104 - 
    create table CHARACTER_ALIAS (
        aliases_id integer not null,
        characters_id integer not null
    )
14:12:24,819 DEBUG SQL:104 - 
    create table CharacterTable (
        id integer not null,
        name varchar(255),
        primary key (id)
    )
14:12:24,819 DEBUG SQL:104 - 
    create index idx_CHARACTER_ALIAS_1 on CHARACTER_ALIAS (characters_id)
14:12:24,819 DEBUG SQL:104 - 
    alter table CHARACTER_ALIAS 
        add constraint FKBFBA17A55528DA3 
        foreign key (characters_id) 
        references CharacterTable
14:12:24,822 DEBUG SQL:104 - 
    alter table CHARACTER_ALIAS 
        add constraint FKBFBA17AA869D0B6 
        foreign key (aliases_id) 
        references Alias
14:12:24,822  INFO SchemaExport:405 - HHH000230: Schema export complete
14:12:24,823  WARN SessionFactoryImpl:1554 - HHH000008: JTASessionContext being used with JDBCTransactionFactory; auto-flush will not operate correctly with getCurrentSession()
14:12:24,823  INFO CustomRunner:139 - Test: testMergeAndHold
14:12:24,826 DEBUG SQL:104 - 
    insert 
    into
        CharacterTable
        (name, id) 
    values
        (?, ?)
14:12:24,826 DEBUG SQL:104 - 
    insert 
    into
        CharacterTable
        (name, id) 
    values
        (?, ?)
14:12:24,827 DEBUG SQL:104 - 
    insert 
    into
        Alias
        (alias, id) 
    values
        (?, ?)
14:12:24,827 DEBUG SQL:104 - 
    insert 
    into
        Alias
        (alias, id) 
    values
        (?, ?)
14:12:24,827 DEBUG SQL:104 - 
    insert 
    into
        Alias
        (alias, id) 
    values
        (?, ?)
14:12:24,866 DEBUG SQL:104 - 
    select
        alias0_.id as id0_1_,
        alias0_.alias as alias0_1_,
        characters1_.aliases_id as aliases1_0_3_,
        character2_.id as characters2_1_3_,
        character2_.id as id2_0_,
        character2_.name as name2_0_ 
    from
        Alias alias0_ 
    left outer join
        CHARACTER_ALIAS characters1_ 
            on alias0_.id=characters1_.aliases_id 
    left outer join
        CharacterTable character2_ 
            on characters1_.characters_id=character2_.id 
    where
        alias0_.id=?
14:12:24,870 DEBUG SQL:104 - 
    select
        character0_.id as id2_1_,
        character0_.name as name2_1_,
        aliases1_.characters_id as characters2_2_3_,
        alias2_.id as aliases1_1_3_,
        alias2_.id as id0_0_,
        alias2_.alias as alias0_0_ 
    from
        CharacterTable character0_ 
    left outer join
        CHARACTER_ALIAS aliases1_ 
            on character0_.id=aliases1_.characters_id 
    left outer join
        Alias alias2_ 
            on aliases1_.aliases_id=alias2_.id 
    where
        character0_.id=?
14:12:24,871 DEBUG SQL:104 - 
    select
        alias0_.id as id0_1_,
        alias0_.alias as alias0_1_,
        characters1_.aliases_id as aliases1_0_3_,
        character2_.id as characters2_1_3_,
        character2_.id as id2_0_,
        character2_.name as name2_0_ 
    from
        Alias alias0_ 
    left outer join
        CHARACTER_ALIAS characters1_ 
            on alias0_.id=characters1_.aliases_id 
    left outer join
        CharacterTable character2_ 
            on characters1_.characters_id=character2_.id 
    where
        alias0_.id=?
14:12:24,872 DEBUG SQL:104 - 
    select
        alias0_.id as id0_1_,
        alias0_.alias as alias0_1_,
        characters1_.aliases_id as aliases1_0_3_,
        character2_.id as characters2_1_3_,
        character2_.id as id2_0_,
        character2_.name as name2_0_ 
    from
        Alias alias0_ 
    left outer join
        CHARACTER_ALIAS characters1_ 
            on alias0_.id=characters1_.aliases_id 
    left outer join
        CharacterTable character2_ 
            on characters1_.characters_id=character2_.id 
    where
        alias0_.id=?
14:12:24,873 DEBUG SQL:104 - 
    insert 
    into
        CHARACTER_ALIAS
        (aliases_id, characters_id) 
    values
        (?, ?)
14:12:24,873 DEBUG SQL:104 - 
    insert 
    into
        CHARACTER_ALIAS
        (aliases_id, characters_id) 
    values
        (?, ?)
14:12:24,873 DEBUG SQL:104 - 
    insert 
    into
        CHARACTER_ALIAS
        (aliases_id, characters_id) 
    values
        (?, ?)
14:12:24,874 DEBUG SQL:104 - 
    select
        character0_.id as id2_1_,
        character0_.name as name2_1_,
        aliases1_.characters_id as characters2_2_3_,
        alias2_.id as aliases1_1_3_,
        alias2_.id as id0_0_,
        alias2_.alias as alias0_0_ 
    from
        CharacterTable character0_ 
    left outer join
        CHARACTER_ALIAS aliases1_ 
            on character0_.id=aliases1_.characters_id 
    left outer join
        Alias alias2_ 
            on aliases1_.aliases_id=alias2_.id 
    where
        character0_.id=?
14:12:24,876 DEBUG SQL:104 - 
    delete 
    from
        CHARACTER_ALIAS 
    where
        aliases_id=?
14:12:24,876 DEBUG SQL:104 - 
    insert 
    into
        CHARACTER_ALIAS
        (aliases_id, characters_id) 
    values
        (?, ?)
14:12:24,876 DEBUG SQL:104 - 
    insert 
    into
        CHARACTER_ALIAS
        (aliases_id, characters_id) 
    values
        (?, ?)
14:12:24,876 DEBUG SQL:104 - 
    delete 
    from
        CHARACTER_ALIAS 
    where
        aliases_id=?
14:12:24,876 DEBUG SQL:104 - 
    insert 
    into
        CHARACTER_ALIAS
        (aliases_id, characters_id) 
    values
        (?, ?)
14:12:24,901 DEBUG SQL:104 - 
    insert 
    into
        CHARACTER_ALIAS
        (aliases_id, characters_id) 
    values
        (?, ?)
14:12:24,902 DEBUG SQL:104 - 
    delete 
    from
        CHARACTER_ALIAS 
    where
        aliases_id=?
14:12:24,902 DEBUG SQL:104 - 
    insert 
    into
        CHARACTER_ALIAS
        (aliases_id, characters_id) 
    values
        (?, ?)
14:12:24,903 DEBUG SQL:104 - 
    insert 
    into
        CHARACTER_ALIAS
        (aliases_id, characters_id) 
    values
        (?, ?)
14:12:24,913 DEBUG QueryTranslatorImpl:265 - parse() - HQL: select c from org.hibernate.test.event.collection.detached.Character c join c.aliases a where a.alias = :aParam
14:12:24,945 DEBUG QueryTranslatorImpl:283 - --- HQL AST ---
 \-[QUERY] Node: 'query'
    +-[SELECT_FROM] Node: 'SELECT_FROM'
    |  +-[FROM] Node: 'from'
    |  |  +-[RANGE] Node: 'RANGE'
    |  |  |  +-[DOT] Node: '.'
    |  |  |  |  +-[DOT] Node: '.'
    |  |  |  |  |  +-[DOT] Node: '.'
    |  |  |  |  |  |  +-[DOT] Node: '.'
    |  |  |  |  |  |  |  +-[DOT] Node: '.'
    |  |  |  |  |  |  |  |  +-[DOT] Node: '.'
    |  |  |  |  |  |  |  |  |  +-[IDENT] Node: 'org'
    |  |  |  |  |  |  |  |  |  \-[IDENT] Node: 'hibernate'
    |  |  |  |  |  |  |  |  \-[IDENT] Node: 'test'
    |  |  |  |  |  |  |  \-[IDENT] Node: 'event'
    |  |  |  |  |  |  \-[IDENT] Node: 'collection'
    |  |  |  |  |  \-[IDENT] Node: 'detached'
    |  |  |  |  \-[IDENT] Node: 'Character'
    |  |  |  \-[ALIAS] Node: 'c'
    |  |  \-[JOIN] Node: 'join'
    |  |     +-[DOT] Node: '.'
    |  |     |  +-[IDENT] Node: 'c'
    |  |     |  \-[IDENT] Node: 'aliases'
    |  |     \-[ALIAS] Node: 'a'
    |  \-[SELECT] Node: 'select'
    |     \-[IDENT] Node: 'c'
    \-[WHERE] Node: 'where'
       \-[EQ] Node: '='
          +-[DOT] Node: '.'
          |  +-[IDENT] Node: 'a'
          |  \-[IDENT] Node: 'alias'
          \-[COLON] Node: ':'
             \-[IDENT] Node: 'aParam'

14:12:24,945 DEBUG ErrorCounter:82 - throwQueryException() : no errors
14:12:24,945 DEBUG FromElement:157 - FromClause{level=1} : org.hibernate.test.event.collection.detached.Character (c) -> character0_
14:12:24,946 DEBUG FromReferenceNode:74 - Resolved : c -> character0_.id
14:12:24,946 DEBUG DotNode:599 - getDataType() : aliases -> org.hibernate.type.BagType(org.hibernate.test.event.collection.detached.Character.aliases)
14:12:24,946 DEBUG FromElementFactory:385 - createManyToMany() : path = c.aliases role = org.hibernate.test.event.collection.detached.Character.aliases associatedEntityName = org.hibernate.test.event.collection.detached.Alias
14:12:24,946 DEBUG FromElement:157 - FromClause{level=1} : org.hibernate.test.event.collection.detached.Alias (a) -> alias2_
14:12:24,946 DEBUG FromClause:282 - addJoinByPathMap() : c.aliases -> FromElement{explicit,not a collection join,not a fetch join,fetch non-lazy properties,classAlias=a,role=null,tableName=Alias,tableAlias=alias2_,origin=CharacterTable character0_,columns={character0_.id ,className=org.hibernate.test.event.collection.detached.Alias}}
14:12:24,946 DEBUG DotNode:308 - dereferenceCollection() : Created new FROM element for c.aliases : CHARACTER_ALIAS alias2_
14:12:24,946 DEBUG FromReferenceNode:74 - Resolved : c.aliases -> .
14:12:24,947 DEBUG HqlSqlWalker:403 - createFromJoinElement() : -- join tree --
 \-[JOIN_FRAGMENT] FromElement: 'CHARACTER_ALIAS alias2_' FromElement{explicit,not a collection join,not a fetch join,fetch non-lazy properties,classAlias=a,role=org.hibernate.test.event.collection.detached.Character.aliases,tableName=Alias,tableAlias=alias2_,origin=CharacterTable character0_,columns={character0_.id ,className=org.hibernate.test.event.collection.detached.Alias}}

14:12:24,947 DEBUG FromReferenceNode:74 - Resolved : c -> character0_.id
14:12:24,947 DEBUG FromReferenceNode:74 - Resolved : a -> alias2_.id
14:12:24,947 DEBUG DotNode:599 - getDataType() : alias -> org.hibernate.type.StringType@2dc8de40
14:12:24,947 DEBUG FromReferenceNode:74 - Resolved : a.alias -> alias2_.alias
14:12:24,947 DEBUG HqlSqlWalker:629 - processQuery() :  ( SELECT ( {select clause} character0_.id ) ( FromClause{level=1} ( CharacterTable character0_ CHARACTER_ALIAS alias2_ ) ) ( where ( = ( alias2_.alias alias2_.id alias ) ? ) ) )
14:12:24,948 DEBUG JoinProcessor:175 - Using FROM fragment [CharacterTable character0_]
14:12:24,948 DEBUG JoinProcessor:175 - Using FROM fragment [inner join CHARACTER_ALIAS aliases1_ on character0_.id=aliases1_.characters_id inner join Alias alias2_ on aliases1_.aliases_id=alias2_.id]
14:12:24,948 DEBUG QueryTranslatorImpl:252 - --- SQL AST ---
 \-[SELECT] QueryNode: 'SELECT'  querySpaces (Alias,CHARACTER_ALIAS,CharacterTable)
    +-[SELECT_CLAUSE] SelectClause: '{select clause}'
    |  +-[ALIAS_REF] IdentNode: 'character0_.id as id2_' {alias=c, className=org.hibernate.test.event.collection.detached.Character, tableAlias=character0_}
    |  \-[SQL_TOKEN] SqlFragment: 'character0_.name as name2_'
    +-[FROM] FromClause: 'from' FromClause{level=1, fromElementCounter=2, fromElements=2, fromElementByClassAlias=[c, a], fromElementByTableAlias=[alias2_, character0_], fromElementsByPath=[c.aliases], collectionJoinFromElementsByPath=[], impliedElements=[]}
    |  \-[FROM_FRAGMENT] FromElement: 'CharacterTable character0_' FromElement{explicit,not a collection join,not a fetch join,fetch non-lazy properties,classAlias=c,role=null,tableName=CharacterTable,tableAlias=character0_,origin=null,columns={,className=org.hibernate.test.event.collection.detached.Character}}
    |     \-[JOIN_FRAGMENT] FromElement: 'inner join CHARACTER_ALIAS aliases1_ on character0_.id=aliases1_.characters_id inner join Alias alias2_ on aliases1_.aliases_id=alias2_.id' FromElement{explicit,not a collection join,not a fetch join,fetch non-lazy properties,classAlias=a,role=org.hibernate.test.event.collection.detached.Character.aliases,tableName=Alias,tableAlias=alias2_,origin=CharacterTable character0_,columns={character0_.id ,className=org.hibernate.test.event.collection.detached.Alias}}
    \-[WHERE] SqlNode: 'where'
       \-[EQ] BinaryLogicOperatorNode: '='
          +-[DOT] DotNode: 'alias2_.alias' {propertyName=alias,dereferenceType=ALL,propertyPath=alias,path=a.alias,tableAlias=alias2_,className=org.hibernate.test.event.collection.detached.Alias,classAlias=a}
          |  +-[ALIAS_REF] IdentNode: 'alias2_.id' {alias=a, className=org.hibernate.test.event.collection.detached.Alias, tableAlias=alias2_}
          |  \-[IDENT] IdentNode: 'alias' {originalText=alias}
          \-[NAMED_PARAM] ParameterNode: '?' {name=aParam, expectedType=org.hibernate.type.StringType@2dc8de40}

14:12:24,948 DEBUG ErrorCounter:82 - throwQueryException() : no errors
14:12:24,948 DEBUG QueryTranslatorImpl:235 - HQL: select c from org.hibernate.test.event.collection.detached.Character c join c.aliases a where a.alias = :aParam
14:12:24,948 DEBUG QueryTranslatorImpl:236 - SQL: select character0_.id as id2_, character0_.name as name2_ from CharacterTable character0_ inner join CHARACTER_ALIAS aliases1_ on character0_.id=aliases1_.characters_id inner join Alias alias2_ on aliases1_.aliases_id=alias2_.id where alias2_.alias=?
14:12:24,948 DEBUG ErrorCounter:82 - throwQueryException() : no errors
14:12:24,949 DEBUG SQL:104 - 
    select
        character0_.id as id2_,
        character0_.name as name2_ 
    from
        CharacterTable character0_ 
    inner join
        CHARACTER_ALIAS aliases1_ 
            on character0_.id=aliases1_.characters_id 
    inner join
        Alias alias2_ 
            on aliases1_.aliases_id=alias2_.id 
    where
        alias2_.alias=?
14:12:24,951  INFO SchemaExport:343 - HHH000227: Running hbm2ddl schema export
14:12:24,952 DEBUG SchemaExport:353 - Import file not found: /import.sql
14:12:24,952 DEBUG SQL:104 - 
    alter table CHARACTER_ALIAS 
        drop constraint FKBFBA17A55528DA3
14:12:24,953 DEBUG SQL:104 - 
    alter table CHARACTER_ALIAS 
        drop constraint FKBFBA17AA869D0B6
14:12:24,953 DEBUG SQL:104 - 
    drop table Alias if exists
14:12:24,953 DEBUG SQL:104 - 
    drop table CHARACTER_ALIAS if exists
14:12:24,954 DEBUG SQL:104 - 
    drop table CharacterTable if exists
14:12:24,954  INFO SchemaExport:405 - HHH000230: Schema export complete
14:12:24,954  INFO DriverManagerConnectionProviderImpl:162 - HHH000030: Cleaning up connection pool [jdbc:h2:mem:db1;DB_CLOSE_DELAY=-1;MVCC=TRUE]
]]></system-out>
  <system-err><![CDATA[]]></system-err>
</testsuite>
